{"ast":null,"code":"var _jsxFileName = \"/home/nick-levhsin/Programming/Paint/client/src/components/Canvas.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useRef, useState } from 'react';\nimport '../styles/canvas.scss';\nimport { observer } from 'mobx-react-lite';\nimport canvasState from '../store/canvasState';\nimport toolState from '../store/toolState';\nimport Brush from '../tools/Brush';\nimport Rect from '../tools/Rect';\nimport { useParams } from 'react-router-dom';\nimport Button from 'react-bootstrap/Button';\nimport Modal from 'react-bootstrap/Modal';\nimport Form from 'react-bootstrap/Form';\nimport Circle from '../tools/Circle';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst Canvas = _s(observer(_c = _s(() => {\n  _s();\n\n  const canvasRef = useRef(null);\n  const usernameRef = useRef(null);\n  const [modal, setModal] = useState(true);\n  const params = useParams();\n  useEffect(() => {\n    canvasState.setCanvas(canvasRef.current);\n  }, []);\n  useEffect(() => {\n    if (canvasState.username) {\n      const socket = new WebSocket('ws://localhost:5000/');\n      canvasState.setSocket(socket);\n      canvasState.setSessionId(params.id);\n      toolState.setTool(new Brush(canvasRef.current, socket, params.id));\n\n      socket.onopen = () => {\n        socket.send(JSON.stringify({\n          id: params.id,\n          username: canvasState.username,\n          method: 'connection'\n        }));\n      };\n\n      socket.onmessage = event => {\n        let msg = JSON.parse(event.data);\n\n        switch (msg.method) {\n          case 'connection':\n            console.log(`User ${msg.username} connected`);\n            break;\n\n          case 'draw':\n            drawHandler(msg);\n            break;\n        }\n      };\n    }\n  }, [canvasState.username]);\n\n  const drawHandler = msg => {\n    var _canvasRef$current;\n\n    const figure = msg.figure;\n    const ctx = (_canvasRef$current = canvasRef.current) === null || _canvasRef$current === void 0 ? void 0 : _canvasRef$current.getContext('2d');\n\n    if (figure !== null && figure !== void 0 && figure.type) {\n      switch (figure.type) {\n        case 'brush':\n          Brush.draw(ctx, figure.x, figure.y);\n          break;\n\n        case 'rect':\n          Rect.staticDraw(ctx, figure.x, figure.y, figure === null || figure === void 0 ? void 0 : figure.width, figure === null || figure === void 0 ? void 0 : figure.height, figure === null || figure === void 0 ? void 0 : figure.color);\n          break;\n\n        case 'circle':\n          Circle.staticDraw(ctx, figure.x, figure.y, figure === null || figure === void 0 ? void 0 : figure.radius, figure === null || figure === void 0 ? void 0 : figure.color);\n          break;\n\n        case 'finish':\n          ctx.beginPath();\n          break;\n      }\n    }\n  };\n\n  const mouseDownHandler = () => {\n    canvasState.pushToUndo(canvasRef.current.toDataURL());\n  };\n\n  const connectHandler = () => {\n    canvasState.setUsername(usernameRef.current.value);\n    setModal(false);\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"canvas\",\n      children: [/*#__PURE__*/_jsxDEV(Modal, {\n        show: modal,\n        onHide: () => setModal(false),\n        children: [/*#__PURE__*/_jsxDEV(Modal.Header, {\n          closeButton: true,\n          children: /*#__PURE__*/_jsxDEV(Modal.Title, {\n            children: \"Your name\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 118,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 117,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Modal.Body, {\n          children: /*#__PURE__*/_jsxDEV(Form.Control, {\n            ref: usernameRef\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 121,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 120,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Modal.Footer, {\n          children: /*#__PURE__*/_jsxDEV(Button, {\n            variant: \"primary\",\n            onClick: () => connectHandler(),\n            children: \"Connect\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 124,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 123,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n        ref: canvasRef,\n        width: 600,\n        height: 400,\n        onMouseDown: mouseDownHandler\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 129,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 7\n    }, this)\n  }, void 0, false);\n}, \"frpiFXrwApBwe8aIG91Eg0cuJTQ=\", false, function () {\n  return [useParams];\n})), \"frpiFXrwApBwe8aIG91Eg0cuJTQ=\", false, function () {\n  return [useParams];\n});\n\n_c2 = Canvas;\nexport default Canvas;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"Canvas$observer\");\n$RefreshReg$(_c2, \"Canvas\");","map":{"version":3,"names":["React","useEffect","useRef","useState","observer","canvasState","toolState","Brush","Rect","useParams","Button","Modal","Form","Circle","Canvas","canvasRef","usernameRef","modal","setModal","params","setCanvas","current","username","socket","WebSocket","setSocket","setSessionId","id","setTool","onopen","send","JSON","stringify","method","onmessage","event","msg","parse","data","console","log","drawHandler","figure","ctx","getContext","type","draw","x","y","staticDraw","width","height","color","radius","beginPath","mouseDownHandler","pushToUndo","toDataURL","connectHandler","setUsername","value"],"sources":["/home/nick-levhsin/Programming/Paint/client/src/components/Canvas.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport '../styles/canvas.scss';\nimport { observer } from 'mobx-react-lite';\nimport canvasState from '../store/canvasState';\nimport toolState from '../store/toolState';\nimport Brush from '../tools/Brush';\nimport Rect from '../tools/Rect';\nimport { useParams } from 'react-router-dom';\n\nimport Button from 'react-bootstrap/Button';\nimport Modal from 'react-bootstrap/Modal';\nimport Form from 'react-bootstrap/Form';\nimport { Msg } from '../types/msg';\nimport Circle from '../tools/Circle';\n\nconst Canvas: React.FC = observer(() => {\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const usernameRef = useRef<HTMLInputElement>(null);\n  const [modal, setModal] = useState(true);\n  const params = useParams();\n\n  useEffect(() => {\n    canvasState.setCanvas(canvasRef.current);\n  }, []);\n\n  useEffect(() => {\n    if (canvasState.username) {\n      const socket = new WebSocket('ws://localhost:5000/');\n      canvasState.setSocket(socket);\n      canvasState.setSessionId(params.id as string);\n\n      toolState.setTool(\n        new Brush(\n          canvasRef.current as HTMLCanvasElement,\n          socket,\n          params.id as string\n        )\n      );\n\n      socket.onopen = () => {\n        socket.send(\n          JSON.stringify({\n            id: params.id,\n            username: canvasState.username,\n            method: 'connection',\n          })\n        );\n      };\n      socket.onmessage = (event) => {\n        let msg = JSON.parse(event.data);\n        switch (msg.method) {\n          case 'connection':\n            console.log(`User ${msg.username} connected`);\n            break;\n\n          case 'draw':\n            drawHandler(msg);\n            break;\n        }\n      };\n    }\n  }, [canvasState.username]);\n\n  const drawHandler = (msg: Msg) => {\n    const figure = msg.figure;\n    const ctx = canvasRef.current?.getContext('2d') as CanvasRenderingContext2D;\n\n    if (figure?.type) {\n      switch (figure.type) {\n        case 'brush':\n          Brush.draw(ctx as CanvasRenderingContext2D, figure.x, figure.y);\n          break;\n\n        case 'rect':\n          Rect.staticDraw(\n            ctx as CanvasRenderingContext2D,\n            figure.x,\n            figure.y,\n            figure?.width as number,\n            figure?.height as number,\n            figure?.color as string\n          );\n          break;\n\n        case 'circle':\n          Circle.staticDraw(\n            ctx as CanvasRenderingContext2D,\n            figure.x,\n            figure.y,\n            figure?.radius as number,\n            figure?.color as string\n          );\n          break;\n\n        case 'finish':\n          ctx.beginPath();\n          break;\n      }\n    }\n  };\n\n  const mouseDownHandler = () => {\n    canvasState.pushToUndo(\n      (canvasRef.current as HTMLCanvasElement).toDataURL()\n    );\n  };\n\n  const connectHandler = () => {\n    canvasState.setUsername((usernameRef.current as HTMLInputElement).value);\n    setModal(false);\n  };\n\n  return (\n    <>\n      <div className=\"canvas\">\n        <Modal show={modal} onHide={() => setModal(false)}>\n          <Modal.Header closeButton>\n            <Modal.Title>Your name</Modal.Title>\n          </Modal.Header>\n          <Modal.Body>\n            <Form.Control ref={usernameRef} />\n          </Modal.Body>\n          <Modal.Footer>\n            <Button variant=\"primary\" onClick={() => connectHandler()}>\n              Connect\n            </Button>\n          </Modal.Footer>\n        </Modal>\n        <canvas\n          ref={canvasRef}\n          width={600}\n          height={400}\n          onMouseDown={mouseDownHandler}\n        ></canvas>\n      </div>\n    </>\n  );\n});\n\nexport default Canvas;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}