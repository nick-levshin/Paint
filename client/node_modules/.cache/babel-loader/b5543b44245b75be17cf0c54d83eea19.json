{"ast":null,"code":"var _jsxFileName = \"/home/nick-levhsin/Programming/Paint/client/src/components/Canvas.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useRef, useState } from 'react';\nimport '../styles/canvas.scss';\nimport { observer } from 'mobx-react-lite';\nimport canvasState from '../store/canvasState';\nimport toolState from '../store/toolState';\nimport Brush from '../tools/Brush';\nimport Rect from '../tools/Rect';\nimport axios from 'axios';\nimport { useParams } from 'react-router-dom';\nimport Button from 'react-bootstrap/Button';\nimport Modal from 'react-bootstrap/Modal';\nimport Form from 'react-bootstrap/Form';\nimport Circle from '../tools/Circle';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst Canvas = _s(observer(_c = _s(() => {\n  _s();\n\n  const canvasRef = useRef(null);\n  const usernameRef = useRef(null);\n  const [modal, setModal] = useState(true);\n  const params = useParams();\n  useEffect(() => {\n    canvasState.setCanvas(canvasRef.current);\n    axios.get(`http://localhost:5000/image?id=${params.id}`).then(res => {\n      const img = new Image();\n      img.src = res.saved;\n\n      img.onload = () => {\n        var _this$ctx, _this$ctx2, _this$ctx3, _this$ctx4, _this$ctx5, _this$ctx6;\n\n        (_this$ctx = this.ctx) === null || _this$ctx === void 0 ? void 0 : _this$ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n        (_this$ctx2 = this.ctx) === null || _this$ctx2 === void 0 ? void 0 : _this$ctx2.drawImage(img, 0, 0, this.canvas.width, this.canvas.height);\n        (_this$ctx3 = this.ctx) === null || _this$ctx3 === void 0 ? void 0 : _this$ctx3.beginPath();\n        (_this$ctx4 = this.ctx) === null || _this$ctx4 === void 0 ? void 0 : _this$ctx4.rect(x, y, w, h);\n        (_this$ctx5 = this.ctx) === null || _this$ctx5 === void 0 ? void 0 : _this$ctx5.fill();\n        (_this$ctx6 = this.ctx) === null || _this$ctx6 === void 0 ? void 0 : _this$ctx6.stroke();\n      };\n    });\n  }, []);\n  useEffect(() => {\n    if (canvasState.username) {\n      const socket = new WebSocket('ws://localhost:5000/');\n      canvasState.setSocket(socket);\n      canvasState.setSessionId(params.id);\n      toolState.setTool(new Brush(canvasRef.current, socket, params.id));\n\n      socket.onopen = () => {\n        socket.send(JSON.stringify({\n          id: params.id,\n          username: canvasState.username,\n          method: 'connection'\n        }));\n      };\n\n      socket.onmessage = event => {\n        let msg = JSON.parse(event.data);\n\n        switch (msg.method) {\n          case 'connection':\n            console.log(`User ${msg.username} connected`);\n            break;\n\n          case 'draw':\n            drawHandler(msg);\n            break;\n        }\n      };\n    }\n  }, [canvasState.username]);\n\n  const drawHandler = msg => {\n    var _canvasRef$current;\n\n    const figure = msg.figure;\n    const ctx = (_canvasRef$current = canvasRef.current) === null || _canvasRef$current === void 0 ? void 0 : _canvasRef$current.getContext('2d');\n\n    if (figure !== null && figure !== void 0 && figure.type) {\n      switch (figure.type) {\n        case 'brush':\n          Brush.draw(ctx, figure.x, figure.y, figure.color);\n          break;\n\n        case 'rect':\n          Rect.staticDraw(ctx, figure.x, figure.y, figure === null || figure === void 0 ? void 0 : figure.width, figure === null || figure === void 0 ? void 0 : figure.height, figure.color);\n          break;\n\n        case 'circle':\n          Circle.staticDraw(ctx, figure.x, figure.y, figure === null || figure === void 0 ? void 0 : figure.radius, figure.color);\n          break;\n\n        case 'finish':\n          ctx.beginPath();\n          break;\n      }\n    }\n  };\n\n  const mouseDownHandler = () => {\n    var _canvasRef$current2;\n\n    canvasState.pushToUndo(canvasRef.current.toDataURL());\n    axios.post(`http://localhost:5000/image?id=${params.id}`, {\n      img: (_canvasRef$current2 = canvasRef.current) === null || _canvasRef$current2 === void 0 ? void 0 : _canvasRef$current2.toDataURL()\n    }).then(res => console.log(res.data));\n  };\n\n  const connectHandler = () => {\n    canvasState.setUsername(usernameRef.current.value);\n    setModal(false);\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"canvas\",\n      children: [/*#__PURE__*/_jsxDEV(Modal, {\n        show: modal,\n        onHide: () => setModal(false),\n        children: [/*#__PURE__*/_jsxDEV(Modal.Header, {\n          closeButton: true,\n          children: /*#__PURE__*/_jsxDEV(Modal.Title, {\n            children: \"Your name\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 141,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 140,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Modal.Body, {\n          children: /*#__PURE__*/_jsxDEV(Form.Control, {\n            ref: usernameRef\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 144,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 143,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Modal.Footer, {\n          children: /*#__PURE__*/_jsxDEV(Button, {\n            variant: \"primary\",\n            onClick: () => connectHandler(),\n            children: \"Connect\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 147,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 146,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 139,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n        ref: canvasRef,\n        width: 600,\n        height: 400,\n        onMouseDown: mouseDownHandler\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 152,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 7\n    }, this)\n  }, void 0, false);\n}, \"frpiFXrwApBwe8aIG91Eg0cuJTQ=\", false, function () {\n  return [useParams];\n})), \"frpiFXrwApBwe8aIG91Eg0cuJTQ=\", false, function () {\n  return [useParams];\n});\n\n_c2 = Canvas;\nexport default Canvas;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"Canvas$observer\");\n$RefreshReg$(_c2, \"Canvas\");","map":{"version":3,"names":["React","useEffect","useRef","useState","observer","canvasState","toolState","Brush","Rect","axios","useParams","Button","Modal","Form","Circle","Canvas","canvasRef","usernameRef","modal","setModal","params","setCanvas","current","get","id","then","res","img","Image","src","saved","onload","ctx","clearRect","canvas","width","height","drawImage","beginPath","rect","x","y","w","h","fill","stroke","username","socket","WebSocket","setSocket","setSessionId","setTool","onopen","send","JSON","stringify","method","onmessage","event","msg","parse","data","console","log","drawHandler","figure","getContext","type","draw","color","staticDraw","radius","mouseDownHandler","pushToUndo","toDataURL","post","connectHandler","setUsername","value"],"sources":["/home/nick-levhsin/Programming/Paint/client/src/components/Canvas.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport '../styles/canvas.scss';\nimport { observer } from 'mobx-react-lite';\nimport canvasState from '../store/canvasState';\nimport toolState from '../store/toolState';\nimport Brush from '../tools/Brush';\nimport Rect from '../tools/Rect';\nimport axios from 'axios';\nimport { useParams } from 'react-router-dom';\n\nimport Button from 'react-bootstrap/Button';\nimport Modal from 'react-bootstrap/Modal';\nimport Form from 'react-bootstrap/Form';\nimport { Msg } from '../types/msg';\nimport Circle from '../tools/Circle';\n\nconst Canvas: React.FC = observer(() => {\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const usernameRef = useRef<HTMLInputElement>(null);\n  const [modal, setModal] = useState(true);\n  const params = useParams();\n\n  useEffect(() => {\n    canvasState.setCanvas(canvasRef.current);\n    axios.get(`http://localhost:5000/image?id=${params.id}`).then((res) => {\n      const img = new Image();\n      img.src = res.saved;\n      img.onload = () => {\n        this.ctx?.clearRect(0, 0, this.canvas.width, this.canvas.height);\n        this.ctx?.drawImage(img, 0, 0, this.canvas.width, this.canvas.height);\n        this.ctx?.beginPath();\n        this.ctx?.rect(x, y, w, h);\n        this.ctx?.fill();\n        this.ctx?.stroke();\n      };\n    });\n  }, []);\n\n  useEffect(() => {\n    if (canvasState.username) {\n      const socket = new WebSocket('ws://localhost:5000/');\n      canvasState.setSocket(socket);\n      canvasState.setSessionId(params.id as string);\n\n      toolState.setTool(\n        new Brush(\n          canvasRef.current as HTMLCanvasElement,\n          socket,\n          params.id as string\n        )\n      );\n\n      socket.onopen = () => {\n        socket.send(\n          JSON.stringify({\n            id: params.id,\n            username: canvasState.username,\n            method: 'connection',\n          })\n        );\n      };\n      socket.onmessage = (event) => {\n        let msg = JSON.parse(event.data);\n        switch (msg.method) {\n          case 'connection':\n            console.log(`User ${msg.username} connected`);\n            break;\n\n          case 'draw':\n            drawHandler(msg);\n            break;\n        }\n      };\n    }\n  }, [canvasState.username]);\n\n  const drawHandler = (msg: Msg) => {\n    const figure = msg.figure;\n    const ctx = canvasRef.current?.getContext('2d') as CanvasRenderingContext2D;\n\n    if (figure?.type) {\n      switch (figure.type) {\n        case 'brush':\n          Brush.draw(\n            ctx as CanvasRenderingContext2D,\n            figure.x,\n            figure.y,\n            figure.color\n          );\n          break;\n\n        case 'rect':\n          Rect.staticDraw(\n            ctx as CanvasRenderingContext2D,\n            figure.x,\n            figure.y,\n            figure?.width as number,\n            figure?.height as number,\n            figure.color\n          );\n          break;\n\n        case 'circle':\n          Circle.staticDraw(\n            ctx as CanvasRenderingContext2D,\n            figure.x,\n            figure.y,\n            figure?.radius as number,\n            figure.color\n          );\n          break;\n\n        case 'finish':\n          ctx.beginPath();\n          break;\n      }\n    }\n  };\n\n  const mouseDownHandler = () => {\n    canvasState.pushToUndo(\n      (canvasRef.current as HTMLCanvasElement).toDataURL()\n    );\n    axios\n      .post(`http://localhost:5000/image?id=${params.id}`, {\n        img: canvasRef.current?.toDataURL(),\n      })\n      .then((res) => console.log(res.data));\n  };\n\n  const connectHandler = () => {\n    canvasState.setUsername((usernameRef.current as HTMLInputElement).value);\n    setModal(false);\n  };\n\n  return (\n    <>\n      <div className=\"canvas\">\n        <Modal show={modal} onHide={() => setModal(false)}>\n          <Modal.Header closeButton>\n            <Modal.Title>Your name</Modal.Title>\n          </Modal.Header>\n          <Modal.Body>\n            <Form.Control ref={usernameRef} />\n          </Modal.Body>\n          <Modal.Footer>\n            <Button variant=\"primary\" onClick={() => connectHandler()}>\n              Connect\n            </Button>\n          </Modal.Footer>\n        </Modal>\n        <canvas\n          ref={canvasRef}\n          width={600}\n          height={400}\n          onMouseDown={mouseDownHandler}\n        ></canvas>\n      </div>\n    </>\n  );\n});\n\nexport default Canvas;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}