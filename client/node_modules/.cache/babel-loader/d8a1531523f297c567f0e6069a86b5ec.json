{"ast":null,"code":"var _jsxFileName = \"/home/nick-levhsin/Programming/Paint/client/src/components/Canvas.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useRef, useState } from 'react';\nimport '../styles/canvas.scss';\nimport { observer } from 'mobx-react-lite';\nimport canvasState from '../store/canvasState';\nimport toolState from '../store/toolState';\nimport Brush from '../tools/Brush';\nimport Rect from '../tools/Rect';\nimport axios from 'axios';\nimport { useParams } from 'react-router-dom';\nimport Button from 'react-bootstrap/Button';\nimport Modal from 'react-bootstrap/Modal';\nimport Form from 'react-bootstrap/Form';\nimport Circle from '../tools/Circle';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst Canvas = _s(observer(_c = _s(() => {\n  _s();\n\n  const canvasRef = useRef(null);\n  const usernameRef = useRef(null);\n  const [modal, setModal] = useState(true);\n  const params = useParams();\n  useEffect(() => {\n    var _canvasRef$current;\n\n    canvasState.setCanvas(canvasRef.current);\n    const ctx = (_canvasRef$current = canvasRef.current) === null || _canvasRef$current === void 0 ? void 0 : _canvasRef$current.getContext('2d');\n    axios.get(`http://localhost:5000/image?id=${params.id}`).then(res => {\n      const img = new Image();\n      img.src = res.data;\n\n      img.onload = () => {\n        var _canvasRef$current2, _canvasRef$current3, _canvasRef$current4, _canvasRef$current5, _canvasRef$current6, _canvasRef$current7;\n\n        ctx === null || ctx === void 0 ? void 0 : ctx.clearRect(0, 0, (_canvasRef$current2 = canvasRef.current) === null || _canvasRef$current2 === void 0 ? void 0 : _canvasRef$current2.width, (_canvasRef$current3 = canvasRef.current) === null || _canvasRef$current3 === void 0 ? void 0 : _canvasRef$current3.height);\n        console.log((_canvasRef$current4 = canvasRef.current) === null || _canvasRef$current4 === void 0 ? void 0 : _canvasRef$current4.width, (_canvasRef$current5 = canvasRef.current) === null || _canvasRef$current5 === void 0 ? void 0 : _canvasRef$current5.height);\n        ctx === null || ctx === void 0 ? void 0 : ctx.drawImage(img, 0, 0, (_canvasRef$current6 = canvasRef.current) === null || _canvasRef$current6 === void 0 ? void 0 : _canvasRef$current6.width, (_canvasRef$current7 = canvasRef.current) === null || _canvasRef$current7 === void 0 ? void 0 : _canvasRef$current7.height);\n      };\n    }).catch(e => console.log(e));\n  }, []);\n  useEffect(() => {\n    if (canvasState.username) {\n      const socket = new WebSocket('ws://localhost:5000/');\n      canvasState.setSocket(socket);\n      canvasState.setSessionId(params.id);\n      toolState.setTool(new Brush(canvasRef.current, socket, params.id));\n\n      socket.onopen = () => {\n        socket.send(JSON.stringify({\n          id: params.id,\n          username: canvasState.username,\n          method: 'connection'\n        }));\n      };\n\n      socket.onmessage = event => {\n        let msg = JSON.parse(event.data);\n\n        switch (msg.method) {\n          case 'connection':\n            console.log(`User ${msg.username} connected`);\n            break;\n\n          case 'draw':\n            drawHandler(msg);\n            break;\n        }\n      };\n    }\n  }, [canvasState.username]);\n\n  const drawHandler = msg => {\n    var _canvasRef$current8;\n\n    const figure = msg.figure;\n    const ctx = (_canvasRef$current8 = canvasRef.current) === null || _canvasRef$current8 === void 0 ? void 0 : _canvasRef$current8.getContext('2d');\n\n    if (figure !== null && figure !== void 0 && figure.type) {\n      switch (figure.type) {\n        case 'brush':\n          Brush.draw(ctx, figure.x, figure.y, figure.color);\n          break;\n\n        case 'rect':\n          Rect.staticDraw(ctx, figure.x, figure.y, figure === null || figure === void 0 ? void 0 : figure.width, figure === null || figure === void 0 ? void 0 : figure.height, figure.color);\n          break;\n\n        case 'circle':\n          Circle.staticDraw(ctx, figure.x, figure.y, figure === null || figure === void 0 ? void 0 : figure.radius, figure.color);\n          break;\n\n        case 'finish':\n          ctx.beginPath();\n          break;\n      }\n    }\n  };\n\n  const mouseDownHandler = () => {\n    var _canvasRef$current9, _canvasRef$current10;\n\n    canvasState.pushToUndo(canvasRef.current.toDataURL());\n    console.log((_canvasRef$current9 = canvasRef.current) === null || _canvasRef$current9 === void 0 ? void 0 : _canvasRef$current9.toDataURL());\n    axios.post(`http://localhost:5000/image?id=${params.id}`, {\n      img: (_canvasRef$current10 = canvasRef.current) === null || _canvasRef$current10 === void 0 ? void 0 : _canvasRef$current10.toDataURL()\n    }).then(res => console.log(res.data));\n  };\n\n  const connectHandler = () => {\n    canvasState.setUsername(usernameRef.current.value);\n    setModal(false);\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"canvas\",\n      children: [/*#__PURE__*/_jsxDEV(Modal, {\n        show: modal,\n        onHide: () => setModal(false),\n        children: [/*#__PURE__*/_jsxDEV(Modal.Header, {\n          closeButton: true,\n          children: /*#__PURE__*/_jsxDEV(Modal.Title, {\n            children: \"Your name\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 160,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 159,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Modal.Body, {\n          children: /*#__PURE__*/_jsxDEV(Form.Control, {\n            ref: usernameRef\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 163,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 162,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Modal.Footer, {\n          children: /*#__PURE__*/_jsxDEV(Button, {\n            variant: \"primary\",\n            onClick: () => connectHandler(),\n            children: \"Connect\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 166,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 165,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 158,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n        ref: canvasRef,\n        width: 600,\n        height: 400,\n        onMouseDown: mouseDownHandler\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 171,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 157,\n      columnNumber: 7\n    }, this)\n  }, void 0, false);\n}, \"frpiFXrwApBwe8aIG91Eg0cuJTQ=\", false, function () {\n  return [useParams];\n})), \"frpiFXrwApBwe8aIG91Eg0cuJTQ=\", false, function () {\n  return [useParams];\n});\n\n_c2 = Canvas;\nexport default Canvas;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"Canvas$observer\");\n$RefreshReg$(_c2, \"Canvas\");","map":{"version":3,"names":["React","useEffect","useRef","useState","observer","canvasState","toolState","Brush","Rect","axios","useParams","Button","Modal","Form","Circle","Canvas","canvasRef","usernameRef","modal","setModal","params","setCanvas","current","ctx","getContext","get","id","then","res","img","Image","src","data","onload","clearRect","width","height","console","log","drawImage","catch","e","username","socket","WebSocket","setSocket","setSessionId","setTool","onopen","send","JSON","stringify","method","onmessage","event","msg","parse","drawHandler","figure","type","draw","x","y","color","staticDraw","radius","beginPath","mouseDownHandler","pushToUndo","toDataURL","post","connectHandler","setUsername","value"],"sources":["/home/nick-levhsin/Programming/Paint/client/src/components/Canvas.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport '../styles/canvas.scss';\nimport { observer } from 'mobx-react-lite';\nimport canvasState from '../store/canvasState';\nimport toolState from '../store/toolState';\nimport Brush from '../tools/Brush';\nimport Rect from '../tools/Rect';\nimport axios from 'axios';\nimport { useParams } from 'react-router-dom';\n\nimport Button from 'react-bootstrap/Button';\nimport Modal from 'react-bootstrap/Modal';\nimport Form from 'react-bootstrap/Form';\nimport { Msg } from '../types/msg';\nimport Circle from '../tools/Circle';\n\nconst Canvas: React.FC = observer(() => {\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const usernameRef = useRef<HTMLInputElement>(null);\n  const [modal, setModal] = useState(true);\n  const params = useParams();\n\n  useEffect(() => {\n    canvasState.setCanvas(canvasRef.current);\n    const ctx = canvasRef.current?.getContext('2d');\n    axios\n      .get(`http://localhost:5000/image?id=${params.id}`)\n      .then((res) => {\n        const img = new Image();\n        img.src = res.data;\n        img.onload = () => {\n          ctx?.clearRect(\n            0,\n            0,\n            canvasRef.current?.width as number,\n            canvasRef.current?.height as number\n          );\n          console.log(\n            canvasRef.current?.width as number,\n            canvasRef.current?.height as number\n          );\n\n          ctx?.drawImage(\n            img,\n            0,\n            0,\n            canvasRef.current?.width as number,\n            canvasRef.current?.height as number\n          );\n        };\n      })\n      .catch((e) => console.log(e));\n  }, []);\n\n  useEffect(() => {\n    if (canvasState.username) {\n      const socket = new WebSocket('ws://localhost:5000/');\n      canvasState.setSocket(socket);\n      canvasState.setSessionId(params.id as string);\n\n      toolState.setTool(\n        new Brush(\n          canvasRef.current as HTMLCanvasElement,\n          socket,\n          params.id as string\n        )\n      );\n\n      socket.onopen = () => {\n        socket.send(\n          JSON.stringify({\n            id: params.id,\n            username: canvasState.username,\n            method: 'connection',\n          })\n        );\n      };\n      socket.onmessage = (event) => {\n        let msg = JSON.parse(event.data);\n        switch (msg.method) {\n          case 'connection':\n            console.log(`User ${msg.username} connected`);\n            break;\n\n          case 'draw':\n            drawHandler(msg);\n            break;\n        }\n      };\n    }\n  }, [canvasState.username]);\n\n  const drawHandler = (msg: Msg) => {\n    const figure = msg.figure;\n    const ctx = canvasRef.current?.getContext('2d') as CanvasRenderingContext2D;\n\n    if (figure?.type) {\n      switch (figure.type) {\n        case 'brush':\n          Brush.draw(\n            ctx as CanvasRenderingContext2D,\n            figure.x,\n            figure.y,\n            figure.color\n          );\n          break;\n\n        case 'rect':\n          Rect.staticDraw(\n            ctx as CanvasRenderingContext2D,\n            figure.x,\n            figure.y,\n            figure?.width as number,\n            figure?.height as number,\n            figure.color\n          );\n          break;\n\n        case 'circle':\n          Circle.staticDraw(\n            ctx as CanvasRenderingContext2D,\n            figure.x,\n            figure.y,\n            figure?.radius as number,\n            figure.color\n          );\n          break;\n\n        case 'finish':\n          ctx.beginPath();\n          break;\n      }\n    }\n  };\n\n  const mouseDownHandler = () => {\n    canvasState.pushToUndo(\n      (canvasRef.current as HTMLCanvasElement).toDataURL()\n    );\n\n    console.log(canvasRef.current?.toDataURL());\n\n    axios\n      .post(`http://localhost:5000/image?id=${params.id}`, {\n        img: canvasRef.current?.toDataURL(),\n      })\n      .then((res) => console.log(res.data));\n  };\n\n  const connectHandler = () => {\n    canvasState.setUsername((usernameRef.current as HTMLInputElement).value);\n    setModal(false);\n  };\n\n  return (\n    <>\n      <div className=\"canvas\">\n        <Modal show={modal} onHide={() => setModal(false)}>\n          <Modal.Header closeButton>\n            <Modal.Title>Your name</Modal.Title>\n          </Modal.Header>\n          <Modal.Body>\n            <Form.Control ref={usernameRef} />\n          </Modal.Body>\n          <Modal.Footer>\n            <Button variant=\"primary\" onClick={() => connectHandler()}>\n              Connect\n            </Button>\n          </Modal.Footer>\n        </Modal>\n        <canvas\n          ref={canvasRef}\n          width={600}\n          height={400}\n          onMouseDown={mouseDownHandler}\n        ></canvas>\n      </div>\n    </>\n  );\n});\n\nexport default Canvas;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}