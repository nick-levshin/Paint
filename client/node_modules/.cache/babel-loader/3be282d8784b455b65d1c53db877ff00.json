{"ast":null,"code":"var _jsxFileName = \"/home/nick-levhsin/Programming/Paint/client/src/components/Canvas.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useRef, useState } from 'react';\nimport '../styles/canvas.scss';\nimport { observer } from 'mobx-react-lite';\nimport canvasState from '../store/canvasState';\nimport toolState from '../store/toolState';\nimport Brush from '../tools/Brush';\nimport Rect from '../tools/Rect';\nimport axios from 'axios';\nimport { useParams } from 'react-router-dom';\nimport Button from 'react-bootstrap/Button';\nimport Modal from 'react-bootstrap/Modal';\nimport Form from 'react-bootstrap/Form';\nimport Circle from '../tools/Circle';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst Canvas = _s(observer(_c = _s(() => {\n  _s();\n\n  const canvasRef = useRef(null);\n  const usernameRef = useRef(null);\n  const [modal, setModal] = useState(true);\n  const params = useParams();\n  useEffect(() => {\n    canvasState.setCanvas(canvasRef.current);\n    axios.get(`http://localhost:5000/image?id=${params.id}`).then(res => {\n      const img = new Image();\n      img.src = res.data;\n\n      img.onload = () => {\n        var _canvasRef$current, _canvasRef$current2, _canvasRef$current3, _this$ctx, _canvasRef$current4, _canvasRef$current5, _this$ctx2;\n\n        (_canvasRef$current = canvasRef.current) === null || _canvasRef$current === void 0 ? void 0 : _canvasRef$current.c.clearRect(0, 0, (_canvasRef$current2 = canvasRef.current) === null || _canvasRef$current2 === void 0 ? void 0 : _canvasRef$current2.width, (_canvasRef$current3 = canvasRef.current) === null || _canvasRef$current3 === void 0 ? void 0 : _canvasRef$current3.height);\n        (_this$ctx = this.ctx) === null || _this$ctx === void 0 ? void 0 : _this$ctx.drawImage(img, 0, 0, (_canvasRef$current4 = canvasRef.current) === null || _canvasRef$current4 === void 0 ? void 0 : _canvasRef$current4.width, (_canvasRef$current5 = canvasRef.current) === null || _canvasRef$current5 === void 0 ? void 0 : _canvasRef$current5.height);\n        (_this$ctx2 = this.ctx) === null || _this$ctx2 === void 0 ? void 0 : _this$ctx2.stroke();\n      };\n    });\n  }, []);\n  useEffect(() => {\n    if (canvasState.username) {\n      const socket = new WebSocket('ws://localhost:5000/');\n      canvasState.setSocket(socket);\n      canvasState.setSessionId(params.id);\n      toolState.setTool(new Brush(canvasRef.current, socket, params.id));\n\n      socket.onopen = () => {\n        socket.send(JSON.stringify({\n          id: params.id,\n          username: canvasState.username,\n          method: 'connection'\n        }));\n      };\n\n      socket.onmessage = event => {\n        let msg = JSON.parse(event.data);\n\n        switch (msg.method) {\n          case 'connection':\n            console.log(`User ${msg.username} connected`);\n            break;\n\n          case 'draw':\n            drawHandler(msg);\n            break;\n        }\n      };\n    }\n  }, [canvasState.username]);\n\n  const drawHandler = msg => {\n    var _canvasRef$current6;\n\n    const figure = msg.figure;\n    const ctx = (_canvasRef$current6 = canvasRef.current) === null || _canvasRef$current6 === void 0 ? void 0 : _canvasRef$current6.getContext('2d');\n\n    if (figure !== null && figure !== void 0 && figure.type) {\n      switch (figure.type) {\n        case 'brush':\n          Brush.draw(ctx, figure.x, figure.y, figure.color);\n          break;\n\n        case 'rect':\n          Rect.staticDraw(ctx, figure.x, figure.y, figure === null || figure === void 0 ? void 0 : figure.width, figure === null || figure === void 0 ? void 0 : figure.height, figure.color);\n          break;\n\n        case 'circle':\n          Circle.staticDraw(ctx, figure.x, figure.y, figure === null || figure === void 0 ? void 0 : figure.radius, figure.color);\n          break;\n\n        case 'finish':\n          ctx.beginPath();\n          break;\n      }\n    }\n  };\n\n  const mouseDownHandler = () => {\n    var _canvasRef$current7;\n\n    canvasState.pushToUndo(canvasRef.current.toDataURL());\n    axios.post(`http://localhost:5000/image?id=${params.id}`, {\n      img: (_canvasRef$current7 = canvasRef.current) === null || _canvasRef$current7 === void 0 ? void 0 : _canvasRef$current7.toDataURL()\n    }).then(res => console.log(res.data));\n  };\n\n  const connectHandler = () => {\n    canvasState.setUsername(usernameRef.current.value);\n    setModal(false);\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"canvas\",\n      children: [/*#__PURE__*/_jsxDEV(Modal, {\n        show: modal,\n        onHide: () => setModal(false),\n        children: [/*#__PURE__*/_jsxDEV(Modal.Header, {\n          closeButton: true,\n          children: /*#__PURE__*/_jsxDEV(Modal.Title, {\n            children: \"Your name\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 149,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 148,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Modal.Body, {\n          children: /*#__PURE__*/_jsxDEV(Form.Control, {\n            ref: usernameRef\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 152,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 151,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Modal.Footer, {\n          children: /*#__PURE__*/_jsxDEV(Button, {\n            variant: \"primary\",\n            onClick: () => connectHandler(),\n            children: \"Connect\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 155,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 154,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 147,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n        ref: canvasRef,\n        width: 600,\n        height: 400,\n        onMouseDown: mouseDownHandler\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 160,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 146,\n      columnNumber: 7\n    }, this)\n  }, void 0, false);\n}, \"frpiFXrwApBwe8aIG91Eg0cuJTQ=\", false, function () {\n  return [useParams];\n})), \"frpiFXrwApBwe8aIG91Eg0cuJTQ=\", false, function () {\n  return [useParams];\n});\n\n_c2 = Canvas;\nexport default Canvas;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"Canvas$observer\");\n$RefreshReg$(_c2, \"Canvas\");","map":{"version":3,"names":["React","useEffect","useRef","useState","observer","canvasState","toolState","Brush","Rect","axios","useParams","Button","Modal","Form","Circle","Canvas","canvasRef","usernameRef","modal","setModal","params","setCanvas","current","get","id","then","res","img","Image","src","data","onload","c","clearRect","width","height","ctx","drawImage","stroke","username","socket","WebSocket","setSocket","setSessionId","setTool","onopen","send","JSON","stringify","method","onmessage","event","msg","parse","console","log","drawHandler","figure","getContext","type","draw","x","y","color","staticDraw","radius","beginPath","mouseDownHandler","pushToUndo","toDataURL","post","connectHandler","setUsername","value"],"sources":["/home/nick-levhsin/Programming/Paint/client/src/components/Canvas.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport '../styles/canvas.scss';\nimport { observer } from 'mobx-react-lite';\nimport canvasState from '../store/canvasState';\nimport toolState from '../store/toolState';\nimport Brush from '../tools/Brush';\nimport Rect from '../tools/Rect';\nimport axios from 'axios';\nimport { useParams } from 'react-router-dom';\n\nimport Button from 'react-bootstrap/Button';\nimport Modal from 'react-bootstrap/Modal';\nimport Form from 'react-bootstrap/Form';\nimport { Msg } from '../types/msg';\nimport Circle from '../tools/Circle';\n\nconst Canvas: React.FC = observer(() => {\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const usernameRef = useRef<HTMLInputElement>(null);\n  const [modal, setModal] = useState(true);\n  const params = useParams();\n\n  useEffect(() => {\n    canvasState.setCanvas(canvasRef.current);\n    axios.get(`http://localhost:5000/image?id=${params.id}`).then((res) => {\n      const img = new Image();\n      img.src = res.data;\n      img.onload = () => {\n        canvasRef.current?.c.clearRect(\n          0,\n          0,\n          canvasRef.current?.width,\n          canvasRef.current?.height\n        );\n        this.ctx?.drawImage(\n          img,\n          0,\n          0,\n          canvasRef.current?.width,\n          canvasRef.current?.height\n        );\n        this.ctx?.stroke();\n      };\n    });\n  }, []);\n\n  useEffect(() => {\n    if (canvasState.username) {\n      const socket = new WebSocket('ws://localhost:5000/');\n      canvasState.setSocket(socket);\n      canvasState.setSessionId(params.id as string);\n\n      toolState.setTool(\n        new Brush(\n          canvasRef.current as HTMLCanvasElement,\n          socket,\n          params.id as string\n        )\n      );\n\n      socket.onopen = () => {\n        socket.send(\n          JSON.stringify({\n            id: params.id,\n            username: canvasState.username,\n            method: 'connection',\n          })\n        );\n      };\n      socket.onmessage = (event) => {\n        let msg = JSON.parse(event.data);\n        switch (msg.method) {\n          case 'connection':\n            console.log(`User ${msg.username} connected`);\n            break;\n\n          case 'draw':\n            drawHandler(msg);\n            break;\n        }\n      };\n    }\n  }, [canvasState.username]);\n\n  const drawHandler = (msg: Msg) => {\n    const figure = msg.figure;\n    const ctx = canvasRef.current?.getContext('2d') as CanvasRenderingContext2D;\n\n    if (figure?.type) {\n      switch (figure.type) {\n        case 'brush':\n          Brush.draw(\n            ctx as CanvasRenderingContext2D,\n            figure.x,\n            figure.y,\n            figure.color\n          );\n          break;\n\n        case 'rect':\n          Rect.staticDraw(\n            ctx as CanvasRenderingContext2D,\n            figure.x,\n            figure.y,\n            figure?.width as number,\n            figure?.height as number,\n            figure.color\n          );\n          break;\n\n        case 'circle':\n          Circle.staticDraw(\n            ctx as CanvasRenderingContext2D,\n            figure.x,\n            figure.y,\n            figure?.radius as number,\n            figure.color\n          );\n          break;\n\n        case 'finish':\n          ctx.beginPath();\n          break;\n      }\n    }\n  };\n\n  const mouseDownHandler = () => {\n    canvasState.pushToUndo(\n      (canvasRef.current as HTMLCanvasElement).toDataURL()\n    );\n    axios\n      .post(`http://localhost:5000/image?id=${params.id}`, {\n        img: canvasRef.current?.toDataURL(),\n      })\n      .then((res) => console.log(res.data));\n  };\n\n  const connectHandler = () => {\n    canvasState.setUsername((usernameRef.current as HTMLInputElement).value);\n    setModal(false);\n  };\n\n  return (\n    <>\n      <div className=\"canvas\">\n        <Modal show={modal} onHide={() => setModal(false)}>\n          <Modal.Header closeButton>\n            <Modal.Title>Your name</Modal.Title>\n          </Modal.Header>\n          <Modal.Body>\n            <Form.Control ref={usernameRef} />\n          </Modal.Body>\n          <Modal.Footer>\n            <Button variant=\"primary\" onClick={() => connectHandler()}>\n              Connect\n            </Button>\n          </Modal.Footer>\n        </Modal>\n        <canvas\n          ref={canvasRef}\n          width={600}\n          height={400}\n          onMouseDown={mouseDownHandler}\n        ></canvas>\n      </div>\n    </>\n  );\n});\n\nexport default Canvas;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}